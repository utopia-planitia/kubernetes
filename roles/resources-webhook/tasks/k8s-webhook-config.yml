
---
- name: base64 encoded resources webhook client certificate
  # todo: figure useing instead of server.pem ca.pem or client pem or better why client.pem is not working
  local_action: shell cd {{ resources_webhook_cert_dir }}; cat server.pem | base64 | tr -d " \t\n\r"
  register: resources_webhook_client_cert_base64_cli
  changed_when: false

- name: "set resources_webhook_client_cert_base64 variable"
  set_fact:
    resources_webhook_client_cert_base64: "{{ resources_webhook_client_cert_base64_cli.stdout }}"

- name: install resources_webhook
  template:
    src: MutatingWebhookConfiguration.yml.j2
    dest: /etc/kubernetes/manifests/MutatingWebhookConfiguration.yml
